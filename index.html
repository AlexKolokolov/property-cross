<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Property Cross</title>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/extjs/3.4.1-1/resources/css/ext-all.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/extjs/3.4.1-1/adapter/ext/ext-base.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/extjs/3.4.1-1/ext-all-debug.js"></script>
    <script>
        var baseUrl = 'https://api.nestoria.co.uk/api?country=uk&pretty=1&action=search_listings&encoding=json&listing_type=buy&page=1&place_name=';
        Ext.onReady(function() {
            new Ext.Viewport({
                layout: 'border',
                items: [
                    {
                        region: 'north',
                        xtype: 'panel',
                        height: 180,
                        bodyCfg: {
                            id: 'searchPanel'
                        }
                    },{
                        region: 'center',
                        layout: 'fit',
                        xtype: 'panel',
                        bodyCfg: {
                            id: 'resultPanel'
                        }
                    }
                ],
                renderTo: Ext.getBody()
            });
            var tip = "Use the form below to search for houses to buy. You can search by place-name, postcode, or click 'My location', to search in your current location!";

            var searchForm = new Ext.form.FormPanel({
                renderTo: 'searchPanel',
                width: 300,
                padding: 5,
                items: [
                    {
                        xtype: 'panel',
                        html: '<p>' + tip + '</p>',
                        padding: 5,
                        border: false
                    },{
                        xtype: 'textfield',
                        hideLabel: true,
                        name: 'keyWord'
                    },{
                        xtype: 'button',
                        text: 'GO',
                        onClick: function () {
                            var searchUrl = baseUrl + searchForm.getForm().findField('keyWord').getValue();
                            resultStore.proxy = new Ext.data.ScriptTagProxy({
                                url: searchUrl
                            });
                            resultGrid.show();
                            resultStore.load();

                        }
                    }
                ]
            });
            var resultStore = new Ext.data.JsonStore({
                root: 'response.listings',
                fields: ['thumb_url','title','summary','price_formatted']
            });
            var resultGrid = new Ext.grid.GridPanel({
                title: 'Result',
                store: resultStore,
                autoHeight: true,
                columns: [
                    {header: "Photo", width: 100, dataIndex: 'thumb_url', renderer: renderThumbnail},
                    {header: "Title", width: 300, dataIndex: 'title', sortable: true, renderer: renderTitle},
                    {header: "Summary", width: 300, dataIndex: 'summary', sortable: true},
                    {header: "Price", width: 100, dataIndex: 'price_formatted', sortable: true}
                ],
                renderTo: 'resultPanel',
                hidden: true,
                loadMask: true
            });
            function renderThumbnail(val) {
                return '<img src=\'' + val + '\' >'
            }
            function renderTitle(val) {
                return '<b>' + val + '</b>'
            }
        });
    </script>
</head>
<body>
</body>
</html>