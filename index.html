<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Property Cross</title>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/extjs/3.4.1-1/resources/css/ext-all.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/extjs/3.4.1-1/adapter/ext/ext-base.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/extjs/3.4.1-1/ext-all-debug.js"></script>
    <script>
        var baseUrl = 'https://api.nestoria.co.uk/api?country=uk&pretty=1&action=search_listings&encoding=json&listing_type=buy&page=1&place_name=';
        var tip = "Use the form below to search for houses to buy. You can search by place-name, postcode, or click 'My location', to search in your current location!";

        var searchPanel = new Ext.Panel({
            region: 'north',
            layout: 'fit',
            height: 130,
            border: false
        });

        var resultPanel = new Ext.Panel({
            region: 'center',
            layout: 'fit',
            border: false
        });

        var resultStore = new Ext.data.JsonStore({
            root: 'response.listings',
            fields: ['thumb_url','title','summary','price_formatted']
        });

        var renderThumbnail = function(val) {
            return '<img src=\'' + val + '\' >'
        };

        var renderTitle = function(val) {
            return '<b>' + val + '</b>'
        };

        var resultGrid = new Ext.grid.GridPanel({
            title: 'Result',
            store: resultStore,
            columns: [
                {header: "Photo", width: 100, dataIndex: 'thumb_url', renderer: renderThumbnail},
                {header: "Title", width: 300, dataIndex: 'title', sortable: true, renderer: renderTitle},
                {header: "Summary", width: 300, dataIndex: 'summary', sortable: true, id: 'summary'},
                {header: "Price", width: 100, dataIndex: 'price_formatted', sortable: true}
            ],
            autoExpandColumn: 'summary',
            hidden: true,
            loadMask: true,
            sm: new Ext.grid.RowSelectionModel({
                singleSelect: true
            })
        });

        Ext.onReady(function() {

            new Ext.Viewport({
                layout: 'border',
                items: [searchPanel,resultPanel],
                renderTo: Ext.getBody()
            });

            var searchForm = new Ext.form.FormPanel({
                width: 300,
                padding: 5,
                border: false,
                items: [
                    {
                        xtype: 'panel',
                        html: '<p>' + tip + '</p>',
                        padding: 5,
                        border: false
                    },{
                        xtype: 'textfield',
                        hideLabel: true,
                        width: 300,
                        height: 25,
                        name: 'keyWord'
                    },{
                        xtype: 'button',
                        text: 'GO',
                        width: 40,
                        height: 25,
                        onClick: function () {
                            var searchUrl = baseUrl + searchForm.getForm().findField('keyWord').getValue();
                            resultStore.proxy = new Ext.data.ScriptTagProxy({
                                url: searchUrl
                            });
                            resultPanel.add(resultGrid);
                            resultPanel.doLayout();
                            resultGrid.show();
                            resultStore.load();
                        }
                    }
                ]
            });

            searchPanel.add(searchForm);
            searchPanel.doLayout();
        });
    </script>
</head>
<body>
</body>
</html>