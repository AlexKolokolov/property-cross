<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Property Cross</title>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/extjs/3.4.1-1/resources/css/ext-all.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/extjs/3.4.1-1/adapter/ext/ext-base.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/extjs/3.4.1-1/ext-all-debug.js"></script>
    <script>
        var baseUrl = 'https://api.nestoria.co.uk/api?country=uk&pretty=1&action=search_listings&encoding=json&listing_type=buy&page=1&place_name=';
        Ext.onReady(function() {
            new Ext.Viewport({
                layout: 'border',
                items: [
                    {
                        region: 'north',
                        xtype: 'panel',
                        height: 300,
                        bodyCfg: {
                            id: 'searchPanel'
                        }
                    },{
                        region: 'center',
                        xtype: 'panel',
                        bodyCfg: {
                            id: 'resultPanel'
                        }
                    }
                ],
                renderTo: Ext.getBody()
            });
            var tip = "Use the form below to search for houses to buy. You can search by place-name, postcode, or click 'My location', to search in your current location!"
            var searchForm = new Ext.form.FormPanel({
                renderTo: 'searchPanel',
                width: 300,
                items: [
                    {
                        xtype: 'panel',
                        html: '<p>' + tip + '</p>'
                    },{
                        xtype: 'textfield',
                        hideLabel: true,
                        name: 'keyWord'
                    },{
                        xtype: 'button',
                        text: 'GO',
                        onClick: function () {
                            var resultStore = new Ext.data.JsonStore({
                                root: 'listings',
                                fields: ['title','price_formatted'],
                                autoLoad: true,
                                proxy: new Ext.data.ScriptTagProxy({
                                    url: baseUrl + searchForm.getForm().findField('keyWord').getValue()
                                })
                            });
                            console.log(resultStore);
                            var grid = new Ext.grid.GridPanel({
                                title: 'Result',
                                store: resultStore,
                                columns: [
                                    {header: "Title", width: 100, dataIndex: 'title', sortable: true},
                                    {header: "Price", width: 100, dataIndex: 'price_formatted', sortable: true}
                                ],
                                renderTo: 'resultPanel'
                            });

                        }
                    }
                ]
            });
        });
    </script>
</head>
<body>
</body>
</html>